<xml xmlns="https://developers.google.com/blockly/xml"><block type="pxt-on-start" id="^JYrudTl/An(yZ~cph[e" x="0" y="0"><statement name="HANDLER"><block type="typescript_statement" id="Oz5::jz)ZXfFTm{X8N3p" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="namespace NewtonovyZakony{" line1="" line2="    //% block=&quot;Spustí odeílatele skupina_rádia: %radioGroup, Osa_akcelerometru: %dimension, popis_hodnoty: %popis_hodnoty, rychlost_motoru: %rychlost_motoru, Pauza_mezi_merenimi(ms): %t_pause, Počet hodnot v klouzavém průměru: %avg_count, Rozsah měřených hodnot: %range&quot;" line3="    export function spustOdesilatele(radioGroup: number, dimension: Dimension, popis_hodnoty:string, rychlost_motoru:number, t_pause?: number, avg_count?: number, range?: AcceleratorRange){" line4="" line5="        let prubezna_hodnota = 0;" line6="        let hodnota_zrychleni = 0;" line7="        let index = 0" line8="        let pole_hodnot: any[] = [];" line9="        let posledni_hodnota = 0;" line10="" line11="        if (!range) range = AcceleratorRange.OneG;" line12="        if (!t_pause) t_pause = 50;" line13="" line14="        radio.setGroup(radioGroup);" line15="        input.setAccelerometerRange(range)" line16="" line17="        control.inBackground(function(){" line18="" line19="            while (true) {" line20="" line21="                let hodnota = input.acceleration(dimension)" line22="                //if (Math.abs(hodnota - posledni_hodnota) &lt; 10) hodnota = posledni_hodnota;" line23="" line24="                posledni_hodnota = hodnota;" line25="" line26="" line27="                if(false){ // klouzavý průměr" line28="" line29="                    pole_hodnot[index] = hodnota;" line30="" line31="                    if (index &gt;= avg_count) index = 0;" line32="" line33="                    let suma = 0" line34="                    for (let i = 0; i &lt; pole_hodnot.length; i++) suma += pole_hodnot[i]" line35="                    hodnota_zrychleni = suma / pole_hodnot.length;" line36="" line37="                }else if(false){ // lowpass" line38="" line39="                    pole_hodnot[index] = hodnota;" line40="" line41="                    if (index &lt; avg_count) index++;" line42="                    else pole_hodnot.shift();" line43="" line44="                    let smoothing = 10; // koeficient vyhlazení" line45="" line46="                    let value = pole_hodnot[0]; // start with the first input" line47="                    for (let j = 1, len = pole_hodnot.length; j &lt; len; j++) {" line48="                        value += (pole_hodnot[j] - value) / smoothing;" line49="                    }" line50="" line51="                    hodnota_zrychleni = value;" line52="                }else{" line53="" line54="                    //let smoothing = 10; // koeficient vyhlazení = avg_count" line55="                    prubezna_hodnota += (hodnota - prubezna_hodnota) / avg_count;" line56="                    hodnota_zrychleni = prubezna_hodnota;" line57="                    " line58="                }" line59="                pause(10);" line60="            }" line61="        });" line62="" line63="        let buffer: any[] = [];" line64="        let buffer_index = 0;" line65="" line66="" line67="        control.inBackground(function () {" line68="            while (true) {" line69="" line70="                buffer[buffer_index] = Math.round(hodnota_zrychleni);" line71="                if (buffer_index &lt; 3) buffer_index++;" line72="                else buffer.shift();" line73="" line74="                pause(t_pause / 3);" line75="            }" line76="        })" line77="" line78="        control.inBackground(function () {" line79="            while (true) {" line80="" line81="                let text = &quot;&quot;;" line82="                for (let k = 0; k &lt; buffer.length; k++){" line83="" line84="                    if (text != '') text += ';'; " line85="                    text += buffer[k];" line86="                     " line87="                }" line88="" line89="                radio.sendString(popis_hodnoty + &quot;:&quot; + text)" line90="                //serial.writeLine(popis_hodnoty + &quot;:&quot; + suma / pole_hodnot.length)" line91="                pause(t_pause);" line92="            }" line93="        })" line94="        " line95="        radio.onReceivedString(function(receivedString: string) {" line96="            " line97="            if (receivedString == 'GOGO'){" line98="" line99="                wuKong.setAllMotor(rychlost_motoru, rychlost_motoru);" line100="                /*" line101="                for(let k = 10; k &gt; 0; k--){" line102="" line103="                    wuKong.setAllMotor(rychlost_motoru/k, rychlost_motoru/k);" line104="                    pause(20);" line105="                }" line106="                */" line107="" line108="            }" line109="" line110="            if (receivedString == 'STOP') {" line111="                wuKong.setAllMotor(0, 0);" line112="            }" line113="        })" line114="" line115="    }" line116="" line117="    //% block=&quot;Spustí Příjemce a ovladač skupina_rádia: %radioGroup&quot;" line118="    export function spustPrijemce(radioGroup: number){" line119="" line120="        let prijato = false;" line121="" line122="        radio.onReceivedString(function (receivedString) {" line123="            if(receivedString.includes(';')){" line124="" line125="                let data = receivedString.split(';');" line126="                let popis = data[0].substr(0, data[0].indexOf(':')+1);" line127="" line128="                serial.writeLine(data[0]);" line129="                pause(10);" line130="" line131="                for (let l = 1; l &lt; data.length; l++){" line132="                    serial.writeLine(popis + data[l]);" line133="                    pause(10);" line134="                }" line135="" line136="            }else{" line137="" line138="" line139="                serial.writeLine(receivedString)" line140="            }" line141="            prijato = true;" line142="        })" line143="        radio.setGroup(radioGroup)" line144="        serial.redirectToUSB()" line145="" line146="        control.runInParallel(function () {" line147="" line148="            while (true){" line149="" line150="                if (prijato){" line151="" line152="                    led.plot(0, 0)" line153="                    pause(100);" line154="                    prijato = false;" line155="                }else{" line156="" line157="                    led.unplot(0, 0);" line158="                    pause(100);" line159="                }" line160="            }" line161="" line162="        });" line163="" line164="        " line165="        input.onButtonPressed(Button.A, function () {" line166="            radio.sendString('GOGO');" line167="        })" line168="" line169="        input.onButtonPressed(Button.B, function () {" line170="            radio.sendString('STOP');" line171="        })" line172="    }" line173="" line174="}" numlines="175"></mutation></block></statement></block></xml>